---
import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';
import { getCollection } from 'astro:content';
import { categories } from '../../data/products';

export async function getStaticPaths() {
  return Object.keys(categories).map(cat => ({
    params: { category: cat.toLowerCase() },
    props: { categoryName: cat }
  }));
}

const { category } = Astro.params;
const { categoryName } = Astro.props;

const allProducts = await getCollection('products');
const filteredProducts = allProducts
    .filter(p => p.data.category.toLowerCase() === category)
    .map(p => ({ ...p.data, id: p.id })); // Adapt for ProductCard
---

<Layout>
  <div class="container mx-auto px-4 py-16">
    <h1 class="text-4xl font-bold text-center mb-12">Our Products</h1>
    
    <!-- Filter -->
    <div class="flex flex-wrap justify-center gap-4 mb-12">
        <a href="/products" class="btn btn-outline">All</a>
        {Object.keys(categories).map(cat => (
            <a href={`/products/${cat.toLowerCase()}`} class={`btn ${categoryName === cat ? 'btn-neutral' : 'btn-outline'}`}>
                {cat}
            </a>
        ))}
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {filteredProducts.map((product) => (
        <ProductCard 
            id={product.id} 
            name={product.name} 
            summary={product.summary} 
            image={product.image} 
            category={product.category} 
        />
      ))}
    </div>
    
    {filteredProducts.length === 0 && (
        <p class="text-center text-gray-500">No products found for this category.</p>
    )}
  </div>
</Layout>
