---
import Layout from "../../layouts/Layout.astro";
import ProductCard from "../../components/ProductCard.astro";
import { getCollection } from "astro:content";
import { categories } from "../../data/products";

export async function getStaticPaths() {
  return Object.keys(categories).map((cat) => ({
    params: { category: cat.toLowerCase() },
    props: { categoryName: cat, categoryData: categories[cat] },
  }));
}

const { category } = Astro.params;
const { categoryName, categoryData } = Astro.props;

const allProducts = await getCollection("products");
const filteredProducts = allProducts
  .filter((p) => p.data.category.toLowerCase() === category)
  .map((p) => ({ ...p.data, id: p.id }))
  .sort((a, b) => b.priority - a.priority); // Sort by name alphabetically
---

<Layout
  title={`제이원텍(주) | ${categoryName}`}
  description={categoryData.description}
>
  <div class="container mx-auto px-4 py-16">
    <!-- Hero Section -->
    <div class="text-center mb-12">
      <div
        class="inline-block px-4 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium mb-4"
      >
        PRODUCTS
      </div>
      <h1 class="text-4xl md:text-5xl font-bold mb-4">{categoryName}</h1>
      <p class="text-base-content/60 max-w-2xl mx-auto">
        {categoryData.description}
      </p>
    </div>

    <!-- Filter -->
    <div class="flex flex-wrap justify-center gap-3 mb-12">
      <a
        href="/products"
        class="btn btn-outline hover:btn-primary gap-2 transition-all"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
          ></path>
        </svg>
        전체
      </a>
      {
        Object.keys(categories).map((cat) => (
          <a
            href={`/products/${cat.toLowerCase()}`}
            class={`btn gap-2 transition-all ${categoryName === cat ? "btn-neutral" : "btn-outline hover:btn-primary"}`}
          >
            {cat}
          </a>
        ))
      }
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        filteredProducts.map((product) => (
          <ProductCard
            id={product.id}
            name={product.name}
            summary={product.summary}
            image={product.image}
            category={product.category}
          />
        ))
      }
    </div>

    {
      filteredProducts.length === 0 && (
        <div class="text-center py-16">
          <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-base-200 flex items-center justify-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-base-content/30"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
              />
            </svg>
          </div>
          <p class="text-base-content/50">해당 카테고리에 제품이 없습니다.</p>
        </div>
      )
    }
  </div>
</Layout>
