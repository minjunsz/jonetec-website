---
import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';
import { getCollection } from 'astro:content';
import { categories } from '../../data/products'; // Keep categories for filter buttons

const products = await getCollection('products');

const categoryKeys = Object.keys(categories);
// Flatten and sort
const filteredProducts = products
    .map(p => ({ ...p.data, id: p.id }))
    .sort((a, b) => {
        const catIndexA = categoryKeys.indexOf(a.category);
        const catIndexB = categoryKeys.indexOf(b.category);
        
        // 1. Sort by Category Order defined in products.ts
        if (catIndexA !== catIndexB) {
            return catIndexA - catIndexB;
        }
        
        // 2. Sort by Name alphabetically within same category
        return a.name.localeCompare(b.name);
    });
---

<Layout title="제이원텍(주) | 제품 소개" description="제이원텍(주) 제품 소개">
  <div class="container mx-auto px-4 py-16">
    <h1 class="text-4xl font-bold text-center mb-12">Our Products</h1>
    
    <!-- Filter -->
    <div class="flex flex-wrap justify-center gap-4 mb-12">
        <a href="/products" class="btn btn-neutral">All</a>
        {Object.keys(categories).map(cat => (
            <a href={`/products/${cat.toLowerCase()}`} class="btn btn-outline">
                {cat}
            </a>
        ))}
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {filteredProducts.map((product) => (
        <ProductCard 
            id={product.id} 
            name={product.name} 
            summary={product.summary} 
            image={product.image} 
            category={product.category} 
        />
      ))}
    </div>
    
    {filteredProducts.length === 0 && (
        <p class="text-center text-gray-500">No products found for this category.</p>
    )}
  </div>
</Layout>
